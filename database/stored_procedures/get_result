-- --------------------------------------------------------------------------------
-- Routine DDL
-- Note: comments before and after the routine body will not be stored by the server
-- --------------------------------------------------------------------------------
DELIMITER $$

CREATE DEFINER=`root`@`localhost` PROCEDURE `get_result`()
BEGIN
	SELECT 	position.pos_id,
		position.pos_name,
		account.acct_lname,
		account.acct_fname,
		account.acct_mname,
		(SELECT count(*) FROM election_candidate,election_voter WHERE candidate_votes.elect_cand_id = election_candidate.elect_cand_id AND candidate_votes.elect_voter_id = election_voter.elect_voter_id AND election_candidate.elect_id = election.elect_id AND election.elect_id = 1 AND program.prog_id = 1 AND election_candidate.status = 1 AND election.status = 1) AS ITE,
		(SELECT count(*) FROM election_candidate,election_voter WHERE candidate_votes.elect_cand_id = election_candidate.elect_cand_id AND candidate_votes.elect_voter_id = election_voter.elect_voter_id AND election_candidate.elect_id = election.elect_id AND election.elect_id = 1 AND program.prog_id = 2 AND election_candidate.status = 1 AND election.status = 1) AS ABA,
		(SELECT count(*) FROM election_candidate,election_voter WHERE candidate_votes.elect_cand_id = election_candidate.elect_cand_id AND candidate_votes.elect_voter_id = election_voter.elect_voter_id AND election_candidate.elect_id = election.elect_id AND election.elect_id = 1 AND program.prog_id = 3 AND election_candidate.status = 1 AND election.status = 1) AS Educ,
		(SELECT count(*) FROM election_candidate,election_voter WHERE candidate_votes.elect_cand_id = election_candidate.elect_cand_id AND candidate_votes.elect_voter_id = election_voter.elect_voter_id AND election_candidate.elect_id = election.elect_id AND election.elect_id = 1 AND program.prog_id = 4 AND election_candidate.status = 1 AND election.status = 1) AS PharmChem,
		(SELECT count(*) FROM election_candidate,election_voter WHERE candidate_votes.elect_cand_id = election_candidate.elect_cand_id AND candidate_votes.elect_voter_id = election_voter.elect_voter_id AND election_candidate.elect_id = election.elect_id AND election.elect_id = 1 AND program.prog_id = 5 AND election_candidate.status = 1 AND election.status = 1) AS NDHM,
		(SELECT count(*) FROM election_candidate,election_voter WHERE candidate_votes.elect_cand_id = election_candidate.elect_cand_id AND candidate_votes.elect_voter_id = election_voter.elect_voter_id AND election_candidate.elect_id = election.elect_id AND election.elect_id = 1 AND program.prog_id = 6 AND election_candidate.status = 1 AND election.status = 1) AS Music,
		(SELECT count(*) FROM election_candidate,election_voter WHERE candidate_votes.elect_cand_id = election_candidate.elect_cand_id AND candidate_votes.elect_voter_id = election_voter.elect_voter_id AND election_candidate.elect_id = election.elect_id AND election.elect_id = 1 AND program.prog_id = 7 AND election_candidate.status = 1 AND election.status = 1) AS LA,
		(SELECT count(*) FROM election_candidate,election_voter WHERE candidate_votes.elect_cand_id = election_candidate.elect_cand_id AND candidate_votes.elect_voter_id = election_voter.elect_voter_id AND election_candidate.elect_id = election.elect_id AND election.elect_id = 1 AND program.prog_id = 8 AND election_candidate.status = 1 AND election.status = 1) AS Engr,
		(SELECT count(*) FROM election_candidate,election_voter WHERE candidate_votes.elect_cand_id = election_candidate.elect_cand_id AND candidate_votes.elect_voter_id = election_voter.elect_voter_id AND election_candidate.elect_id = election.elect_id AND election.elect_id = 1 AND program.prog_id = 9 AND election_candidate.status = 1 AND election.status = 1) AS Nursing,
		(SELECT count(*) FROM election_candidate,election_voter WHERE candidate_votes.elect_cand_id = election_candidate.elect_cand_id AND candidate_votes.elect_voter_id = election_voter.elect_voter_id AND election_candidate.elect_id = election.elect_id AND election.elect_id = 1 AND program.prog_id = 10 AND election_candidate.status = 1 AND election.status = 1) AS MLS

	FROM election_candidate

	LEFT OUTER JOIN candidate_votes ON election_candidate.elect_cand_id = candidate_votes.elect_cand_id 				
	RIGHT OUTER JOIN account ON election_candidate.acct_id = account.acct_id
	LEFT OUTER JOIN course ON account.course_id = course.course_id
	LEFT OUTER JOIN program ON course.prog_id = program.prog_id					
	LEFT OUTER JOIN election ON election_candidate.elect_id = election.elect_id
	RIGHT OUTER JOIN position ON election_candidate.pos_id = position.pos_id 
			 
			AND election_candidate.status = 1
			AND election_candidate.elect_id = (	SELECT election.elect_id 
												FROM election 
												WHERE election.status = 1)
	LEFT OUTER JOIN division ON position.div_id = division.div_id



	GROUP BY election_candidate.elect_cand_id, position.pos_id
	ORDER BY order_no ASC, account.acct_lname ASC;
END